version: "3.9"

services:
  api:
    image: ghcr.io/hallboard-team/dotnet:${DOTNET_VERSION:-10.0}-sdk
    container_name: ${COMPOSE_PROJECT_NAME:-template}_api-dev

    working_dir: /workspaces/app

    volumes:
      # Mount the whole repo into the container
      - ../../:/workspaces/app:Z

      # Shared VS Code server cache, same pattern as frontend
      - ${HOME}/.cache/vscode-server-shared:/home/vscode/.vscode-server-shared:Z
      - ${HOME}/.cache/codex:/home/vscode/.codex:Z

    environment:
      # Matches ENV in the Dockerfile (backend image)
      - VSCODE_SERVER_DIR=/home/vscode/.vscode-server-shared
      - CODEX_HOME=/home/vscode/.codex

    # Expose API port: host:container
    ports:
      - "${PORT:-5000}:5000"

    # Keep container alive; devcontainer will run dotnet from terminal / tasks
    command: >
      bash -c "
        dotnet --info &&
        sleep infinity
      "
